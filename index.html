<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏¥‡∏ß‡∏ï‡∏±‡∏î‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      const API_URL = 'https://script.google.com/macros/s/AKfycbx0Ll2-JkmXrUyg-9b_fXCf08mJzbUltIrdf7nMhpEE/dev';

      async function loadJobs() {
        try {
          const res = await fetch(API_URL);
          const jobs = await res.json();
          const tbody = document.getElementById("jobTable");
          tbody.innerHTML = "";

          let total = 0, done = 0;
          jobs.forEach(job => {
            total++;
            if (job.Status === "‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à") done++;
            const tr = document.createElement("tr");
            tr.className = "border-b hover:bg-gray-100";
            tr.innerHTML = `
              <td class="p-2">${job.Requester}</td>
              <td class="p-2">${job["Job Description"]}</td>
              <td class="p-2">${job["Job Received Date"]}</td>
              <td class="p-2">${job.Remarks}</td>
              <td class="p-2 font-semibold ${job.Status === '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' ? 'text-green-600' : job.Status === '‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏á‡∏≤‡∏ô' ? 'text-pink-600' : 'text-yellow-600'}">${job.Status}</td>
              <td class="p-2 space-x-1 text-center">
                <button onclick="updateStatus(${job.rowIndex}, '‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡∏π‡πà')" class="bg-yellow-300 hover:bg-yellow-400 px-2 py-1 rounded">üõ†</button>
                <button onclick="updateStatus(${job.rowIndex}, '‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏á‡∏≤‡∏ô')" class="bg-pink-300 hover:bg-pink-400 px-2 py-1 rounded">üîî</button>
                <button onclick="updateStatus(${job.rowIndex}, '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à')" class="bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded">‚úÖ</button>
                <button onclick="deleteJob(${job.rowIndex})" class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded">üóë</button>
              </td>
            `;
            tbody.appendChild(tr);
          });

          document.getElementById("total").textContent = total;
          document.getElementById("done").textContent = done;
          document.getElementById("pending").textContent = total - done;
        } catch (e) {
          alert("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: " + e);
        }
      }

      async function submitJob() {
        const job = {
          requester: document.getElementById("requester").value,
          jobDesc: document.getElementById("jobDesc").value,
          jobDate: document.getElementById("jobDate").value,
          remarks: document.getElementById("remarks").value
        };
        try {
          await fetch(API_URL, {
            method: "POST",
            body: JSON.stringify(job),
            headers: { "Content-Type": "application/json" }
          });
          document.getElementById("jobForm").reset();
          loadJobs();
        } catch (e) {
          alert("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: " + e);
        }
      }

      async function updateStatus(row, status) {
        try {
          await fetch(API_URL, {
            method: "PUT",
            body: JSON.stringify({ row, status }),
            headers: { "Content-Type": "application/json" }
          });
          loadJobs();
        } catch (e) {
          alert("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏î‡πâ: " + e);
        }
      }

      async function deleteJob(row) {
        if (confirm("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
          try {
            await fetch(`${API_URL}?row=${row}`, { method: "DELETE" });
            loadJobs();
          } catch (e) {
            alert("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: " + e);
          }
        }
      }

      window.onload = loadJobs;
    </script>
  </head>
  <body class="bg-gray-50 text-sm font-sans">
    <div class="max-w-5xl mx-auto p-6 bg-white shadow-lg rounded-xl mt-8">
      <h1 class="text-2xl font-bold mb-6 text-center text-blue-600">üìπ ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏¥‡∏ß‡∏ï‡∏±‡∏î‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</h1>

      <form id="jobForm" onsubmit="event.preventDefault(); submitJob();" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
        <input id="requester" required placeholder="‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á‡∏á‡∏≤‡∏ô" class="border p-2 rounded" />
        <input id="jobDesc" required placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô" class="border p-2 rounded" />
        <input id="jobDate" type="date" required class="border p-2 rounded" />
        <input id="remarks" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏" class="border p-2 rounded" />
        <div class="md:col-span-2 text-right">
          <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏¥‡∏ß‡∏á‡∏≤‡∏ô</button>
        </div>
      </form>

      <div class="flex justify-between font-medium mb-4">
        <div>‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <span id="total">0</span></div>
        <div>‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: <span id="done">0</span></div>
        <div>‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà: <span id="pending">0</span></div>
      </div>

      <div class="overflow-auto max-h-[500px]">
        <table class="w-full border text-center">
          <thead class="bg-gray-200 sticky top-0">
            <tr>
              <th class="p-2">‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á</th>
              <th class="p-2">‡∏á‡∏≤‡∏ô</th>
              <th class="p-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
              <th class="p-2">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
              <th class="p-2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
              <th class="p-2">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
            </tr>
          </thead>
          <tbody id="jobTable" class="bg-white"></tbody>
        </table>
      </div>
    </div>
  </body>
</html>
